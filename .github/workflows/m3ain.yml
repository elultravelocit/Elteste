name: Kryptex Miner Single VM

on:
  workflow_dispatch: # Para iniciar manualmente

jobs:
  kryptex-single:
    runs-on: windows-latest
    steps:
      - name: Criar pasta de trabalho
        run: |
          mkdir C:\kryptex
          cd C:\kryptex

      - name: Baixar Kryptex
        run: |
          Invoke-WebRequest -Uri "https://update.kryptex.com/windows/KryptexSetup.exe" -OutFile "C:\kryptex\KryptexSetup.exe"

      - name: Instalar Kryptex silenciosamente
        run: |
          Start-Process "C:\kryptex\KryptexSetup.exe" -ArgumentList "/S" -Wait

      - name: Configurar Kryptex Worker
        run: |
          $worker="krxX33M74R.worker" # Insira seu Worker ID aqui
          $pool="xmr.kryptex.network:802"
          $config = @{
              "pools" = @(
                  @{
                      "url" = $pool
                      "user" = $worker
                      "pass" = "x"
                      "keepalive" = true
                      "tls" = true
                  }
              )
          }
          $json = $config | ConvertTo-Json -Depth 10
          Set-Content -Path "C:\kryptex\config.json" -Value $json

      - name: Rodar Kryptex Miner
        run: |
          Start-Process "C:\Program Files (x86)\Kryptex\Kryptex.exe"

      - name: Manter VM ativa por 8h
        run: |
          timeout /t 28800
